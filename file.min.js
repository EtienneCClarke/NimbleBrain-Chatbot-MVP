class Chatbot{constructor(e,t){this.endpoint="https://api.nimblebrain.ai/v1/agents/67/query",this.apiKey=e,this.messages=t?.messages||[],this.setName(t?.name)}async sendMessage(e){try{let t=await this.executeQuery(e);return this.addToHistory(e,"user"),this.addToHistory(t.toString(),"agent"),t}catch(n){if(n)return console.error(n),null}}async executeQuery(e){if(!e||0==e.length||""===e)throw Error("Query cannot be empty");return"**Bold** *Italic* [Link](https://nimblebrain.ai)"}addToHistory(e,t){let n=Date.now();this.messages.push({message:e,sender:t,timestamp:n}),localStorage.setItem("nimblebrain-history",JSON.stringify({name:this.name,messages:this.messages,timestamp:n}))}setName(e){let t=["Samantha","James","Mike","Emily"];e?this.name=e:this.name=t[Math.floor(Math.random()*t.length)],localStorage.setItem("nimblebrain-history",JSON.stringify({name:this.name,messages:this.messages,timestamp:Date.now()}))}}function getScriptParams(){return{apiKey:document.getElementById("nimblebrain-chatbot").getAttribute("data-api-key")||void 0}}async function sleep(e){return new Promise(t=>{setTimeout(t,e)})}const colors={primary:"hsl(216, 86%, 31%)",secondary:"hsl(205, 76%, 84%)",text:"hsl(0, 0%, 5%)",background:"hsl(0, 0%, 94%)",foreground:"hsl(0, 0%, 100%)",emerald:"hsl(140, 52%, 55%)",emeraldShadow:"hsla(140, 52%, 55%, 0.5)",muted:"hsla(0, 0%, 5%, 0.5)"},SVG={robot:'<svg width="17" height="17" viewBox="0 0 17 17" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8.49992 5.83334V3.16667H5.83325" stroke="#0D0D0D" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/><path d="M12.5001 5.83333H4.50008C3.7637 5.83333 3.16675 6.43028 3.16675 7.16666V12.5C3.16675 13.2364 3.7637 13.8333 4.50008 13.8333H12.5001C13.2365 13.8333 13.8334 13.2364 13.8334 12.5V7.16666C13.8334 6.43028 13.2365 5.83333 12.5001 5.83333Z" stroke="#0D0D0D" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/><path d="M1.83325 9.83333H3.16659" stroke="#0D0D0D" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/><path d="M13.8333 9.83333H15.1666" stroke="#0D0D0D" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/><path d="M10.5 9.16667V10.5" stroke="#0D0D0D" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/><path d="M6.5 9.16667V10.5" stroke="#0D0D0D" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/></svg>',send:'<svg width="16" style="margin-bottom: 1px" height="16" viewBox="0 0 11 11" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0_3_81)"><path d="M1.70216 1.39701C1.66094 1.37688 1.61461 1.36965 1.56921 1.37624C1.52382 1.38284 1.48146 1.40296 1.44767 1.43398C1.41388 1.465 1.39022 1.50548 1.37978 1.55015C1.36933 1.59482 1.37259 1.64159 1.38912 1.68438L2.69216 5.18009C2.76901 5.38644 2.76901 5.61357 2.69216 5.81992L1.38958 9.31563C1.37313 9.35837 1.36991 9.40506 1.38035 9.44965C1.39079 9.49424 1.4144 9.53465 1.44811 9.56565C1.48183 9.59664 1.52408 9.61678 1.56939 9.62344C1.61469 9.6301 1.66095 9.62298 1.70216 9.60301L9.95216 5.70717C9.9914 5.68861 10.0246 5.65929 10.0478 5.62261C10.071 5.58594 10.0834 5.54342 10.0834 5.50001C10.0834 5.45659 10.071 5.41408 10.0478 5.3774C10.0246 5.34072 9.9914 5.3114 9.95216 5.29284L1.70216 1.39701Z" stroke="#F0F0F0" stroke-width="0.916667" stroke-linecap="round" stroke-linejoin="round"/><path d="M2.75 5.5H10.0833" stroke="#F0F0F0" stroke-width="0.916667" stroke-linecap="round" stroke-linejoin="round"/></g><defs><clipPath id="clip0_3_81"><rect width="11" height="11" fill="white"/></clipPath></defs></svg>',help:'<svg width="24" style="margin-bottom: 2px" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7.9 20C9.80858 20.9791 12.0041 21.2442 14.0909 20.7478C16.1777 20.2513 18.0186 19.0258 19.2818 17.2922C20.545 15.5585 21.1474 13.4307 20.9806 11.2922C20.8137 9.15361 19.8886 7.14497 18.3718 5.62819C16.855 4.11142 14.8464 3.18625 12.7078 3.01942C10.5693 2.85258 8.44147 3.45505 6.70782 4.71825C4.97417 5.98145 3.74869 7.82231 3.25222 9.90911C2.75575 11.9959 3.02094 14.1914 4 16.1L2 22L7.9 20Z" stroke="#F0F0F0" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M9.09009 9.00001C9.32519 8.33167 9.78924 7.76811 10.4 7.40914C11.0108 7.05016 11.729 6.91894 12.4273 7.03872C13.1255 7.15849 13.7589 7.52153 14.2152 8.06353C14.6714 8.60554 14.9211 9.29153 14.9201 10C14.9201 12 11.9201 13 11.9201 13" stroke="#F0F0F0" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 17H12.01" stroke="#F0F0F0" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>',minimize:'<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4 14H10V20" stroke="#F0F0F0" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M20 10H14V4" stroke="#F0F0F0" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M14 10L21 3" stroke="#F0F0F0" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M3 21L10 14" stroke="#F0F0F0" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>'};let isChatOpen=!1;const fontFamily="Arial, sans-serif",borderRadius=window.innerWidth<900?"8px":"12px",buttonWidth=window.innerWidth<900?"40px":"50px",chatWidth=window.innerWidth<900?"250px":"390px",chatHeight=window.innerWidth<900?window.innerHeight<800?window.innerHeight<600?"400px":"500px":"400px":"625px",headerHeight=window.innerWidth<900?"50px":"75px",headerPaddingHorizontal=window.innerWidth<900?"19px":"12px",headerNameFontSize=window.innerWidth<900?"16px":"20px",headerStatusFontSize=window.innerWidth<900?"8px":"12px",avatarWidth=window.innerWidth<900?"25px":"40px",statusWidth=window.innerWidth<900?"2px":"4px",queryInputHeight=window.innerWidth<900?"35px":"50px",sendBtnWidth=window.innerWidth<900?"20px":"30px",padding=window.innerWidth<900?"8px":"12px",messageFontSize=window.innerWidth<900?"12px":"16px",margins={right:window.innerWidth<900?window.innerWidth<500?20:30:40,bottom:window.innerWidth<900?30:40};let history=JSON.parse(localStorage.getItem("nimblebrain-history"));history&&Date.now()-history?.timestamp>6e5&&(localStorage.removeItem("nimblebrain-history"),history=null);const{apiKey:e}=getScriptParams();let chatbot=new Chatbot(e,history),parserScript=document.createElement("script");parserScript.src="https://cdn.jsdelivr.net/npm/markdown-it@14.1.0/dist/markdown-it.min.js";let firstScriptTag=document.getElementsByTagName("script")[0];firstScriptTag.parentNode.insertBefore(parserScript,firstScriptTag);let md;function loadChatbot(){let e=createWrapper(margins),t=createChat(),n=createToggleButton(t);e.appendChild(t),e.appendChild(n),document.body.appendChild(e)}function createWrapper(e){let t=document.createElement("div");return t.style.position="fixed",t.style.gap="32px",t.style.display="flex",t.style.flexDirection="column",t.style.alignItems="flex-end",t.style.justifyContent="flex-end",t.style.bottom=e.bottom?`${e.bottom}px`:void 0,t.style.right=e.right?`${e.right}px`:void 0,t.style.left=e.left?`${e.left}px`:void 0,t.style.top=e.top?`${e.top}px`:void 0,t.style.maxWidth="390px",t}function createChat(){let e=document.createElement("div");e.style.width=chatWidth,e.style.height=chatHeight,e.style.flexShrink=1,e.style.background=colors.background,e.style.display="none",e.style.flexDirection="column",e.style.boxSizing="border-box",e.style.boxShadow="0 4px 4px 0 hsla(0, 0%, 0%, 0.25)",e.style.borderRadius=borderRadius,e.style.overflow="hidden";let t=createChatHeader(),n=createMessageDisplay(),s=createQueryInput(n);return e.appendChild(t),e.appendChild(n),e.appendChild(s),chatbot.messages&&chatbot.messages.forEach(e=>{let t=createMessageElement(e.message,e.sender);n.appendChild(t)}),e}function createChatHeader(){let e=document.createElement("div");e.style.flexShrink="1",e.style.minHeight=headerHeight,e.style.background=colors.primary,e.style.display="flex",e.style.flexDirection="row",e.style.zIndex=100,e.style.alignItems="center",e.style.paddingInline=padding,e.style.gap=padding,e.style.boxShadow="0 -1px 6px 5px hsla(0, 0%, 0%, 0.17)";let t=document.createElement("div");t.style.display="flex",t.style.flexDirection="column",t.style.gap=window.innerWidth<900?"3px":"5px";let n=document.createElement("p");n.style.fontFamily=fontFamily,n.style.fontSize=headerNameFontSize,n.style.color=colors.foreground,n.style.lineHeight="100%",n.style.margin="0",n.innerText=chatbot.name,t.appendChild(n);let s=createStatus();t.appendChild(s);let i=createAvatar();return e.appendChild(i),e.appendChild(t),e}function createStatus(){let e=document.createElement("div");e.style.display="flex",e.style.flexDirection="row",e.style.alignItems="center",e.style.gap="5px";let t=document.createElement("div");t.style.width=statusWidth,t.style.height=statusWidth,t.style.borderRadius="9999px",t.style.background=colors.emerald,t.style.boxShadow=`0 0 2px 2px ${colors.emeraldShadow}`;let n=document.createElement("p");return n.style.color=colors.foreground,n.style.fontFamily=fontFamily,n.style.fontSize=headerStatusFontSize,n.style.margin="0",n.innerText="Online",e.appendChild(t),e.appendChild(n),e}function createAvatar(){let e=document.createElement("div");return e.style.width=avatarWidth,e.style.aspectRatio="1/1",e.style.background=colors.background,e.style.borderRadius="9999px",e.style.display="flex",e.style.alignItems="center",e.style.justifyContent="center",e.innerHTML=`<span style="scale: ${window.innerWidth<900?"1":"1.4"}">${SVG.robot}</span>`,e}function createMessageDisplay(){let e=document.createElement("div");return e.style.paddingBlock="20px",e.style.gap=padding,e.style.display="flex",e.style.flexDirection="column",e.style.paddingInline=padding,e.style.flexShrink=1,e.style.height="100%",e.style.overflowY="scroll",e.style.overscrollBehavior="contain",e}function createMessageElement(e,t){let n=document.createElement("div");return n.style.display="flex",n.style.width="fit-content",n.style.paddingInline=padding,n.style.borderRadius=borderRadius,n.style.fontFamily=fontFamily,n.style.background=colors.foreground,n.style.borderBottomLeftRadius="0",n.style.maxWidth="80%","user"===t&&(n.style.background=colors.secondary,n.style.marginLeft="auto",n.style.borderBottomRightRadius="0",n.style.borderBottomLeftRadius=borderRadius),n.innerHTML=md.render(`${e}`),n}function createQueryInput(e){let t=document.createElement("div");t.style.display="flex",t.style.alignItems="center",t.style.justifyContent="center",t.style.background=colors.background,t.style.padding=padding,t.style.zIndex=100;let n=document.createElement("div");n.style.display="flex",n.style.alignItems="center",n.style.background=colors.foreground,n.style.borderRadius=borderRadius,n.style.width="100%",n.style.height=queryInputHeight,n.style.overflow="hidden",n.style.boxShadow="0 4px 4px 0 hsla(0, 0%, 0%, 0.1)";let s=document.createElement("input");s.style.flexGrow="1",s.style.border="none",s.style.height="100%",s.style.outline="none",s.style.paddingInline=padding,s.setAttribute("type","text"),s.setAttribute("id","nimblebrain-query-input"),s.placeholder="How can we help you today?";let i=document.createElement("button");return i.style.backgroundColor=colors.primary,i.style.background="linear-gradient(36deg, rgba(98,143,195,1) 0%, rgba(11,65,145,1) 67%);",i.style.display="flex",i.style.alignItems="center",i.style.justifyContent="center",i.style.border="none",i.style.borderRadius="50%",i.style.aspectRatio="1/1",i.style.marginLeft="auto",i.style.marginRight=padding,i.style.width=sendBtnWidth,i.style.cursor="pointer",i.style.display="flex",i.addEventListener("mousedown",e=>{i.style.scale="0.8"}),i.addEventListener("mouseup",e=>{i.style.scale="1"}),i.addEventListener("mouseleave",e=>{i.style.scale="1"}),i.addEventListener("click",async t=>{if(!s.value)return;let n=s.value;s.value="",s.placeholder="Ask a question...";let i=createMessageElement(n,"user");e.appendChild(i),e.scrollTop=e.scrollHeight,await sleep(1e3);let r=await chatbot.sendMessage(n);if(r){let l=createMessageElement(r,"agent");e.appendChild(l)}e.scrollTop=e.scrollHeight}),i.innerHTML=SVG.send,n.appendChild(s),n.appendChild(i),t.appendChild(n),t}function createToggleButton(e){let t=document.createElement("button");return t.style.display="flex",t.style.alignItems="center",t.style.justifyContent="center",t.style.width=buttonWidth,t.style.aspectRatio="1/1",t.style.backgroundColor=colors.primary,t.style.zIndex=100,t.style.borderRadius="50%",t.style.transition="50ms",t.style.boxShadow="0 4px 4px 0 hsla(0, 0%, 0%, 0.25)",t.style.border="none",t.style.cursor="pointer",t.addEventListener("mousedown",e=>{t.style.scale="0.8"}),t.addEventListener("mouseup",e=>{t.style.scale="1"}),t.addEventListener("mouseleave",e=>{t.style.scale="1"}),t.addEventListener("click",()=>{isChatOpen?(e.style.display="none",t.innerHTML=SVG.help,isChatOpen=!1):(e.style.display="flex",t.innerHTML=SVG.minimize,isChatOpen=!0)}),t.innerHTML=SVG.help,t}window.addEventListener("load",e=>{e.preventDefault(),md=window.markdownit({html:!0}),loadChatbot()});